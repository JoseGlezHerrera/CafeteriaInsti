<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewModels="clr-namespace:CafeteriaInsti.ViewModels"
             xmlns:models="clr-namespace:CafeteriaInsti.Models"
             x:Class="CafeteriaInsti.Views.ListaProductosPage"
             x:DataType="viewModels:ListaProductosViewModel"
             Title="{Binding Title}">

    <Grid RowDefinitions="Auto,Auto,*" Padding="10">
        
        <Label Grid.Row="0" 
               Text="Menu de Productos"
               FontSize="28"
               FontAttributes="Bold"
               HorizontalOptions="Center"
               Margin="0,10"/>

        <ScrollView Grid.Row="1" 
                    Orientation="Horizontal"
                    HorizontalScrollBarVisibility="Never"
                    Margin="0,0,0,10">
            <HorizontalStackLayout Spacing="10">
                <Button Text="Todas" 
                        Command="{Binding SeleccionarCategoriaCommand}"
                        CommandParameter="Todas"
                        BackgroundColor="#512BD4"
                        TextColor="White"
                        CornerRadius="20"
                        Padding="18,10"/>
                <Button Text="Bebidas Calientes" 
                        Command="{Binding SeleccionarCategoriaCommand}"
                        CommandParameter="Bebidas Calientes"
                        BackgroundColor="#FFF3E0"
                        TextColor="#D84315"
                        CornerRadius="20"
                        Padding="18,10"/>
                <Button Text="Bebidas Frias" 
                        Command="{Binding SeleccionarCategoriaCommand}"
                        CommandParameter="Bebidas Frias"
                        BackgroundColor="#E3F2FD"
                        TextColor="#1976D2"
                        CornerRadius="20"
                        Padding="18,10"/>
                <Button Text="Postres" 
                        Command="{Binding SeleccionarCategoriaCommand}"
                        CommandParameter="Postres"
                        BackgroundColor="#FCE4EC"
                        TextColor="#C2185B"
                        CornerRadius="20"
                        Padding="18,10"/>
                <Button Text="Snacks" 
                        Command="{Binding SeleccionarCategoriaCommand}"
                        CommandParameter="Snacks"
                        BackgroundColor="#F1F8E9"
                        TextColor="#689F38"
                        CornerRadius="20"
                        Padding="18,10"/>
            </HorizontalStackLayout>
        </ScrollView>

        <CollectionView Grid.Row="2" 
                        ItemsSource="{Binding Productos}"
                        SelectionMode="None">
            
            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="10"/>
            </CollectionView.ItemsLayout>

            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:Producto">
                    <Frame BackgroundColor="White" 
                           Padding="15"
                           CornerRadius="15"
                           HasShadow="True">
                        <Frame.GestureRecognizers>
                            <TapGestureRecognizer 
                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:ListaProductosViewModel}}, Path=GoToDetailsCommand}"
                                CommandParameter="{Binding .}"/>
                        </Frame.GestureRecognizers>
                        <Grid RowDefinitions="Auto,Auto,Auto" ColumnDefinitions="*,Auto">
                            <Label Grid.Row="0" Grid.Column="0"
                                   Text="{Binding Nombre}" 
                                   FontSize="18"
                                   FontAttributes="Bold"/>
                            <Label Grid.Row="1" Grid.Column="0"
                                   Text="{Binding Descripcion}" 
                                   FontSize="14"
                                   TextColor="Gray"/>
                            <Label Grid.Row="2" Grid.Column="0"
                                   Text="{Binding Precio, StringFormat='{0:C}'}" 
                                   FontSize="20"
                                   FontAttributes="Bold"
                                   TextColor="#512BD4"/>
                            <Button Grid.Row="0" Grid.Column="1" Grid.RowSpan="3"
                                    Text="?"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:ListaProductosViewModel}}, Path=ToggleFavoritoCommand}"
                                    CommandParameter="{Binding .}"
                                    BackgroundColor="White"
                                    TextColor="#CCCCCC"
                                    BorderColor="#CCCCCC"
                                    BorderWidth="2"
                                    FontSize="24"
                                    WidthRequest="50"
                                    HeightRequest="50"
                                    CornerRadius="25"/>
                        </Grid>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>

            <CollectionView.EmptyView>
                <Label Text="No hay productos" 
                       FontSize="20"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"/>
            </CollectionView.EmptyView>
        </CollectionView>
    </Grid>
</ContentPage>
